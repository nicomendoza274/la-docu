<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web scraping con Python &mdash; documentación de La Docu 🏠 - </title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/translations.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="prev" title="Python Intermedio" href="python-medium.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> La Docu 🏠
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Frameworks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../frameworks/angular.html">Angular</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Languages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="python-basic.html">Python Básico</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-medium.html">Python Intermedio</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Web scraping con Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#que-es-el-web-scraping">¿Que es el web Scraping?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#por-que-aprender-web-scraping">¿Por que aprender Web Scraping?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#porque-python-para-web-scraping">¿Porque python para Web Scraping?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#http">HTTP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#estructura-de-una-peticion-http">Estructura de una petición HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#estructura-de-la-web">Estructura de la web</a></li>
<li class="toctree-l3"><a class="reference internal" href="#status-codes-mas-comunes">Status codes mas comunes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#html">HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="#robot-txt">Robot.txt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#directivas">DIRECTIVAS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#xpath">XPath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tipos-de-nodos">Tipos de nodos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#expresiones">Expresiones</a></li>
<li class="toctree-l3"><a class="reference internal" href="#predicados">Predicados</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operadores">Operadores</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wildcards">Wildcards</a></li>
<li class="toctree-l3"><a class="reference internal" href="#in-text-search">In-text search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xpath-axes">XPath Axes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scraping-con-python">Scraping con python</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">La Docu 🏠</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Web scraping con Python</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/manuals/languages/python/python-web-scraping.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="python-medium.html" class="btn btn-neutral float-left" title="Python Intermedio" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="web-scraping-con-python">
<h1>Web scraping con Python<a class="headerlink" href="#web-scraping-con-python" title="Enlazar permanentemente con este título"></a></h1>
<p>Última edición el día 2022-04-22 a las 12:53.</p>
<div class="contents local topic" id="table-de-contenidos-de-la-pagina">
<p class="topic-title">Table de contenidos de la pagina</p>
<ul class="simple">
<li><p><a class="reference internal" href="#que-es-el-web-scraping" id="id1">¿Que es el web Scraping?</a></p></li>
<li><p><a class="reference internal" href="#por-que-aprender-web-scraping" id="id2">¿Por que aprender Web Scraping?</a></p></li>
<li><p><a class="reference internal" href="#porque-python-para-web-scraping" id="id3">¿Porque python para Web Scraping?</a></p></li>
<li><p><a class="reference internal" href="#http" id="id4">HTTP</a></p>
<ul>
<li><p><a class="reference internal" href="#estructura-de-una-peticion-http" id="id5">Estructura de una petición HTTP</a></p></li>
<li><p><a class="reference internal" href="#estructura-de-la-web" id="id6">Estructura de la web</a></p></li>
<li><p><a class="reference internal" href="#status-codes-mas-comunes" id="id7">Status codes mas comunes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#html" id="id8">HTML</a></p></li>
<li><p><a class="reference internal" href="#robot-txt" id="id9">Robot.txt</a></p>
<ul>
<li><p><a class="reference internal" href="#directivas" id="id10">DIRECTIVAS</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#xpath" id="id11">XPath</a></p>
<ul>
<li><p><a class="reference internal" href="#tipos-de-nodos" id="id12">Tipos de nodos</a></p></li>
<li><p><a class="reference internal" href="#expresiones" id="id13">Expresiones</a></p></li>
<li><p><a class="reference internal" href="#predicados" id="id14">Predicados</a></p></li>
<li><p><a class="reference internal" href="#operadores" id="id15">Operadores</a></p></li>
<li><p><a class="reference internal" href="#wildcards" id="id16">Wildcards</a></p></li>
<li><p><a class="reference internal" href="#in-text-search" id="id17">In-text search</a></p></li>
<li><p><a class="reference internal" href="#xpath-axes" id="id18">XPath Axes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#scraping-con-python" id="id19">Scraping con python</a></p></li>
</ul>
</div>
<section id="que-es-el-web-scraping">
<h2><a class="toc-backref" href="#id1">¿Que es el web Scraping?</a><a class="headerlink" href="#que-es-el-web-scraping" title="Enlazar permanentemente con este título"></a></h2>
<p><strong>Web scraping:</strong> Es una técnica usada por data scientist y backend developers para extraer información de internet, acceder a esto usando el protocolo de transferencias de hipertexto (HTTP) o a través de un navegador. Los datos extraídos usualmente son guardados en una base de datos, incluso en una hoja de cálculo para posteriores análisis. Puede hacerse de manera automática o manualmente.</p>
<p><strong>Xpath:</strong> es un lenguaje que sirve para apuntar a las partes de un documento XML. Xpath modela un documento XML como un árbol de nodos. Existen diferentes tipos de nodos: elementos, atributos, texto.</p>
</section>
<section id="por-que-aprender-web-scraping">
<h2><a class="toc-backref" href="#id2">¿Por que aprender Web Scraping?</a><a class="headerlink" href="#por-que-aprender-web-scraping" title="Enlazar permanentemente con este título"></a></h2>
<ul class="simple">
<li><p>Para poder seguir el rastro de una persona o de un país (Agencias de inteligencia)</p></li>
<li><p>Para hacer aplicaciones para comprar precios en diferentes paginas (Trivago)</p></li>
<li><p>Utilizado por aplicaciones de e-commerce para comprar precios entre competencias (amazon, eBay, OLX, Mercado Libre)</p></li>
<li><p>Reclutadores de personal lo utilizan para comparar los perfiles y determinar los mas adecuados para un puesto de trabajo.</p></li>
<li><p>En el marketing digital, para analizar los contenidos como tweets y determinar las palabras que se hacen virales o que llegan a Trending topic</p></li>
</ul>
</section>
<section id="porque-python-para-web-scraping">
<h2><a class="toc-backref" href="#id3">¿Porque python para Web Scraping?</a><a class="headerlink" href="#porque-python-para-web-scraping" title="Enlazar permanentemente con este título"></a></h2>
<p>Python es el lenguaje que mas soporte tiene en la comunidad y el open source para realidad este tipo de técnicas. Tiene muchos módulos que nos permiten realizar web scraping. Es el lenguaje mas especializado para hacer ciencia de datos.</p>
<p>Entre los multiples módulos de python para el web scraping están:</p>
<ul class="simple">
<li><p><strong>Requests:</strong> es una librería que nos permite controlar HTTP</p></li>
<li><p><strong>BeautifulSoup:</strong> Sirve para extraer información de un documento HTML</p></li>
</ul>
<p>Existen frameworks avanzados como por ejemplo
* <strong>Selenium</strong> con el cual podemos crear navegadores fantasma y podemos controlar sitios web de manera automática (bots).
* <strong>Scrapy</strong> Es el mas utilizado para hacer web scraping. Es usado por Reino unido para recolectar los datos de la población local.</p>
</section>
<section id="http">
<h2><a class="toc-backref" href="#id4">HTTP</a><a class="headerlink" href="#http" title="Enlazar permanentemente con este título"></a></h2>
<p>HTTP: es un protocolo (conjunto de reglas) a partir del cual 2 computadoras se comunican en el internet. Estas computadoras poseen un nombre:</p>
<ul class="simple">
<li><p>Cliente: Realiza una petición (nuestra computadora)</p></li>
<li><p>Servidor: Responde la petición realizada por el cliente (Google)</p></li>
</ul>
<section id="estructura-de-una-peticion-http">
<h3><a class="toc-backref" href="#id5">Estructura de una petición HTTP</a><a class="headerlink" href="#estructura-de-una-peticion-http" title="Enlazar permanentemente con este título"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Request

GET / HTTP/1.1
Host: developer.mozilla.org
Accept-Language: en

#Response

HTTP/1.1 200 OK
Date: Sat, 09 Oct 2010 14:28:02 GMT
Server: Apache
Last-MOdified: Tue, 01 DEC 2009 20:18:22 GMT
ETag: &quot;51142bc1-7449-479b075b2891b&quot;
Accept-Ranges: bytes
Content-Length: 29769
Content-type: text/html

&lt;!DOCTYPE html... (here comes the 29769 bytes of the requested web page)
</pre></div>
</div>
</section>
<section id="estructura-de-la-web">
<h3><a class="toc-backref" href="#id6">Estructura de la web</a><a class="headerlink" href="#estructura-de-la-web" title="Enlazar permanentemente con este título"></a></h3>
<a class="reference internal image-reference" href="../../../_images/estructura-web.png"><img alt="Logo Angular" class="align-center" src="../../../_images/estructura-web.png" style="width: 400px;" /></a>
<p>Debajo de HTTP tenemos los siguiente protocolos:</p>
<ul class="simple">
<li><p><strong>IP:</strong> Internet Protocolo, a partir del cual salen las direcciones IPV4 e IPV6 que identifican de manera única a nuestra computadora en la red.</p></li>
<li><p><strong>TCP:</strong> Transmisión Control Protocol, que establece como se va a transferir información a bajo nivel.</p></li>
<li><p><strong>UDP:</strong> User Datagram Protocol, parecido a TCP.</p></li>
<li><p><strong>TLS:</strong> Transport Layer Security, relacionado con el encriptado de la información para que el atacante no pueda ver lo que se enviá.</p></li>
<li><p><strong>DNS:</strong> Domain Name System, resuelve nombre de dominio a una IP.</p></li>
</ul>
<p>Por encima tenemos HTTP que nos permite transportar:</p>
<ul class="simple">
<li><p><strong>HTML:</strong> Lenguaje de marcado de un sitio web. Información que vamos a usar para el web scraping.</p></li>
<li><p><strong>:CSS:</strong> Lenguaje de estilos para el sitio web.</p></li>
<li><p><strong>Web APIs:</strong> Interfaz de programación de aplicaciones.</p></li>
<li><p><strong>JavaScript:</strong> Para la interacción entre diferentes partes de una pagina.</p></li>
</ul>
</section>
<section id="status-codes-mas-comunes">
<h3><a class="toc-backref" href="#id7">Status codes mas comunes</a><a class="headerlink" href="#status-codes-mas-comunes" title="Enlazar permanentemente con este título"></a></h3>
<ul class="simple">
<li><p>Status code 200 – OK.</p></li>
<li><p>Status code 301 – Moved Permanently.</p></li>
<li><p>Status code 302 – Moved Temporarily.</p></li>
<li><p>Status code 403 – Forbidden</p></li>
<li><p>Status code 404 – Not Found</p></li>
<li><p>Status code 500 – Internal Server Error</p></li>
<li><p>Status code 503 ­– Service Unavailable</p></li>
</ul>
</section>
</section>
<section id="html">
<h2><a class="toc-backref" href="#id8">HTML</a><a class="headerlink" href="#html" title="Enlazar permanentemente con este título"></a></h2>
<p><strong>HTML:</strong> Hypertext Markup Language, es un lenguaje que nos permite definir la estructura que va a tener una pagina web. Esto es de nuestro interés porque es aquí donde esta la información que queremos extraer, utilizando web scraping.</p>
</section>
<section id="robot-txt">
<h2><a class="toc-backref" href="#id9">Robot.txt</a><a class="headerlink" href="#robot-txt" title="Enlazar permanentemente con este título"></a></h2>
<p>El archivo robots.txt es una forma de administrar una página web. Proporciona información a los rastreadores de los buscadores sobre las páginas o los archivos que pueden solicitar o no de tu sitio web. Principalmente, se utiliza para evitar que tu sitio web se sobrecargue con solicitudes. En el contexto de web scraping, le dice al scraper que puede y no extraer. Es decir hasta donde puede llegar. Ya que infringir en la violación de estas directivas puede acarrear un problema legal con el sitio web al que estamos scrapeando.</p>
<p>Contiene entre otros elementos:</p>
<p><strong>USER-AGENT:</strong> Identificadores de quienes acceden a tu sitio web, puede ser un archivo.py hasta un googlebot.</p>
<section id="directivas">
<h3><a class="toc-backref" href="#id10">DIRECTIVAS</a><a class="headerlink" href="#directivas" title="Enlazar permanentemente con este título"></a></h3>
<ul class="simple">
<li><p><strong>ALLOW:</strong> Utiliza esta directiva para permitir a los motores de búsqueda rastrear un sub-directorio o una página, incluso en un directorio que de otro modo no estaría permitido.</p></li>
<li><p><strong>DISALLOW:</strong> Utiliza esta directiva para indicar a los motores de búsqueda que no accedan a archivos y páginas que se encuentren bajo una ruta específica.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url</span><span class="o">/</span><span class="n">robots</span><span class="o">.</span><span class="n">txt</span>
<span class="n">Pro</span> <span class="n">ejemplo</span><span class="p">:</span>

<span class="c1"># Robots.txt file from http://www.nasa.gov</span>
<span class="c1">#</span>
<span class="c1"># All robots will spider the domain</span>

<span class="n">User</span><span class="o">-</span><span class="n">agent</span><span class="p">:</span> <span class="o">*</span>
<span class="n">Disallow</span><span class="p">:</span> <span class="o">/</span><span class="n">worldbook</span><span class="o">/</span>
<span class="n">Disallow</span><span class="p">:</span> <span class="o">/</span><span class="n">offices</span><span class="o">/</span><span class="n">oce</span><span class="o">/</span><span class="n">llis</span><span class="o">/</span>
</pre></div>
</div>
<p>Para conocer más información de <a class="reference external" href="https://ahrefs.com/blog/es/robots-txt/">robots.txt</a>.</p>
</section>
</section>
<section id="xpath">
<h2><a class="toc-backref" href="#id11">XPath</a><a class="headerlink" href="#xpath" title="Enlazar permanentemente con este título"></a></h2>
<p><strong>XPath:</strong> XML Path Language. XML (extensible markup language) es un lenguaje muy parecido a HTML. Sirvió para definir interfaz, es un lenguaje formado por nodos, es decir etiquetas. Como HTML es parecido a XML podemos hacer uso de esta técnica para extraer información de paginas web.</p>
<section id="tipos-de-nodos">
<h3><a class="toc-backref" href="#id12">Tipos de nodos</a><a class="headerlink" href="#tipos-de-nodos" title="Enlazar permanentemente con este título"></a></h3>
<p>Un nodo es lo mismo que una etiqueta y su contenido. Un nodo puede contener a otros nodos. En otras palabras Xpath nos permitirá navegar en los diferentes niveles de profundidad deseados con el fin extraer información. Para describir los nodos y relaciones con Xpath se usan una sintaxis de ejes.</p>
</section>
<section id="expresiones">
<h3><a class="toc-backref" href="#id13">Expresiones</a><a class="headerlink" href="#expresiones" title="Enlazar permanentemente con este título"></a></h3>
<p>Para escribir expresiones se usara lo siguiente en consola $x(“”). Entre las comillas se van a escribir las expresiones, las expresiones tienen diferentes símbolos que tienen una utilidad.</p>
<p>Se describe la utilidad de cada expresión.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/</span></code> hace referencia a la raíz, o también significa un salto entre nodos. e.g /html/bodyMuestra todo lo que hay dentro del body de html</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">//</span></code> Sirve para acceder a todos los nodos con la etiqueta seleccionada. e.g [<em>//span](//span) muestra todas las etiquetas span</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">..</span></code> Sirve para acceder a los nodos padre de la etiqueta tag. e.g //span/.. accede a todos los nodos padre de span</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.</span></code> Hace referencia al nodo actual. e.g. //span/. es equivalent a //span</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;</span></code> Sirve para traer los atributos. e.g <a class="reference external" href="mailto://div/&#37;&#52;&#48;class">//div/<span>&#64;</span>class</a> Nos da las clases de todos los divs</p></li>
</ul>
</section>
<section id="predicados">
<h3><a class="toc-backref" href="#id14">Predicados</a><a class="headerlink" href="#predicados" title="Enlazar permanentemente con este título"></a></h3>
<p>Para encontrar nuestra información debemos ser más específicos, para ello sirve los predicados. Se escriben entre corchetes []</p>
<p>Ejemplos de predicados:</p>
<ul class="simple">
<li><p><strong>n :</strong> Hace referencia al n elemento de la lista EJ: 1, 2, 3. last(): Al último elemento de la lista.</p></li>
<li><p><strong>&#64;atribute_name :</strong> Al usarse como predicado me trae todos los nodos que contienen este atributo.</p></li>
<li><p><strong>&#64;atribute_name=»value» :</strong> Al usarse como predicado me trae todos los nodos en el que el valor del atributo es value.</p></li>
<li><p><strong>position() :</strong> nos da la posición de una lista para hacer comparaciones</p></li>
</ul>
</section>
<section id="operadores">
<h3><a class="toc-backref" href="#id15">Operadores</a><a class="headerlink" href="#operadores" title="Enlazar permanentemente con este título"></a></h3>
<p>Hay una forma de filtrar más avanzada y es con operadores lógicos. Estos se utilizan dentro del predicado</p>
<ul class="simple">
<li><p><strong>=</strong> - Igual</p></li>
<li><p><strong>!=</strong> - Distinto</p></li>
<li><p><strong>&gt;</strong> - Mayor</p></li>
<li><p><strong>&lt;</strong> - Menor</p></li>
<li><p><strong>and</strong> - and lógico</p></li>
<li><p><strong>or</strong> -  or lógico</p></li>
<li><p><strong>not()</strong> - negación. su argumento es el contenido del predicado</p></li>
</ul>
</section>
<section id="wildcards">
<h3><a class="toc-backref" href="#id16">Wildcards</a><a class="headerlink" href="#wildcards" title="Enlazar permanentemente con este título"></a></h3>
<p>Son los comodines, los utilizamos cuando no sabemos el nodo que queremos traer, pero sabemos mas o menos el lugar donde buscar.</p>
<p>Ejemplos:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$x('/')</span></code> &lt;- Trae todo el documento porque representa la raíz de nuestro el html</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$x('/*')</span></code> &lt;- * después de / pide que traiga todos los nodos que están debajo de / (* es el primer wildcard)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$x('/html/*')</span></code> &lt;- Trae todos los nodos que están inmediatamente después de html</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$x('//*')</span></code> &lt;- // es la expresión para saltar todos los niveles y con el * en todas las direcciones. Trae todos los nodos y todos los atributos de estos nodos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$x('//span[&#64;class=&quot;text]/&#64;*')</span></code> &lt;- Trae todos los span, que tengan como clase “text”, con &#64;* trae todos los atributos. Dicho de otra forma, trae todos los atributos de todos los nodos de tipo span de clase “text”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$x('/html/body//div/&#64;*')</span></code> &lt;- Todos los atributos (usando &#64;*) de todos los div (usando //div) que están después de body</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$x('//span[&#64;class=&quot;text&quot;</span> <span class="pre">and</span> <span class="pre">&#64;itemprop=&quot;text&quot;]/node()')</span></code> &lt;- Trae todos los spam que sean de clase “text” que tengan un atributo &#64;itemprop “text” y de ahí (usando node()) traer todo lo que esté dentro de los spam que cumplen las condiciones</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>node() a diferencia de * trae no solamente los nodos, sino también todo el contenido</p>
</div>
</section>
<section id="in-text-search">
<h3><a class="toc-backref" href="#id17">In-text search</a><a class="headerlink" href="#in-text-search" title="Enlazar permanentemente con este título"></a></h3>
<p>Para buscar cadenas de caracteres especificas dentro de un texto.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">starts-with(.,&quot;Texto</span> <span class="pre">a</span> <span class="pre">buscar&quot;):</span></code> Empezar con, el punto hace referencia al nodo actual.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contains</span> <span class="pre">(.,</span> <span class="pre">&quot;Texto</span> <span class="pre">a</span> <span class="pre">buscar&quot;):</span></code> Sirve para llamar por el texto contenido en.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ends-with(.,&quot;Texto</span> <span class="pre">a</span> <span class="pre">buscar&quot;):</span></code> Terminar con, el punto hace referencia al nodo actual.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matches(.,&quot;Regex&quot;):</span></code> Que coincida la cierta expresión regular.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Debido a las versiones del lenguaje Xpath en los navegadores las funciones end-with y matches no están disponibles, pero una ve en código python corren sin problemas.</p>
</div>
</section>
<section id="xpath-axes">
<h3><a class="toc-backref" href="#id18">XPath Axes</a><a class="headerlink" href="#xpath-axes" title="Enlazar permanentemente con este título"></a></h3>
<p><strong>Azúcar sintáctica</strong> : se refiere a los añadidos a la sintaxis de un lenguaje de programación diseñados para hacer algunas construcciones más fáciles de leer o expresar.</p>
<ul class="simple">
<li><p><strong>self::div</strong> -&gt; se abrevia con . y se refiere al mismo nodo o div en este caso</p></li>
<li><p><strong>child::div</strong> -&gt; Trae los hijos del div</p></li>
<li><p><strong>descendant::div</strong> -&gt; Trae todos los nodos que están en niveles inferiores</p></li>
<li><p><strong>descendant-or-self::div</strong> -&gt; Trae la unión entre los descendientes y el mismo nodo div</p></li>
</ul>
</section>
</section>
<section id="scraping-con-python">
<h2><a class="toc-backref" href="#id19">Scraping con python</a><a class="headerlink" href="#scraping-con-python" title="Enlazar permanentemente con este título"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">lxml.html</span> <span class="k">as</span> <span class="nn">html</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">HOME_URL</span> <span class="o">=</span> <span class="s1">&#39;https://www.larepublica.co/&#39;</span>

<span class="n">XPATH_LINK_TO_ARTICLE</span> <span class="o">=</span> <span class="s1">&#39;//text-fill/a/@href&#39;</span>
<span class="n">XPATH_TITLE</span> <span class="o">=</span> <span class="s1">&#39;//div[@class=&quot;mb-auto&quot;]/text-fill/span/text()&#39;</span>
<span class="n">XPATH_SUMMARY</span> <span class="o">=</span> <span class="s1">&#39;//div[@class=&quot;lead&quot;]/p/text()&#39;</span>
<span class="n">XPATH_BODY</span> <span class="o">=</span> <span class="s1">&#39;//div[@class=&quot;html-content&quot;]/p[not(@class)]/text()&#39;</span>

<span class="k">def</span> <span class="nf">parse_notice</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">today</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">notice</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">notice</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">XPATH_TITLE</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">XPATH_SUMMARY</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">XPATH_BODY</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">body</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ve</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">parser_home</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">HOME_URL</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">home</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">home</span><span class="p">)</span>
            <span class="n">links_to_notices</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">XPATH_LINK_TO_ARTICLE</span><span class="p">)</span>
            <span class="c1"># print(links_to_notices)</span>

            <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">today</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links_to_notices</span><span class="p">:</span>
                <span class="n">parse_notice</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ve</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">parser_home</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="python-medium.html" class="btn btn-neutral float-left" title="Python Intermedio" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2022, Mendoza Nicolás.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>